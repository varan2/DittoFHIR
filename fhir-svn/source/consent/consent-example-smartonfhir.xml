<!--
  This example provides a basic template for recording 
  the consent associated with a SMART on FHIR OAuth dance.

  In SMART on FHIR, the user grants (consents) to a set 
  of actions that the server can take when with regard to 
  release of information from their own record to the application

  This is not the main intended use of the Consent resource,
  and there's no need for the consent resource as part of 
  the SMART on FHIR Authorization process, or when using 
  Heart UMA. Using a Consent resource to record and exchange
  the users consent may be useful for recording and storing 
  the consent and making it available to the user later,
  or for exchanging the patient's consent between AS and RS,
  or between systems in a multi-system virtual RS a very
  common scenario) 

  Note that whichever system builds this Content resource,
  it needs access to information from both the AS and the 
  RS.
  
  Note also, that a situation where a practitioner type user
  authorises the application to access information on a general
  set of patients does not count as 'consent'. 
-->
<Consent xmlns="http://hl7.org/fhir"> 
  <id value="consent-example-smartonfhir"/>
  <status value="active"/>
  <!-- 
   In this SMART on FHIR login, the user consents for data sharing 
   for their elderly parent's record
  -->
  <patient>
    <reference value="Patient/xcda"/>
  </patient>
  <period>
    <start value="2016-06-23T17:02:33+10:00"/>
    <end value="2016-06-23T17:32:33+10:00"/>
  </period>
  <dateTime value="2016-06-23T17:02:33+10:00"/>

  <consentingParty>
    <!-- this is the patient record that matches the person
      making the decision. note: it's not always a related person
    -->
    <reference value="RelatedPerson/peter"/>
  </consentingParty>
  <organization>
    <!-- The organization running the Authentication server -->
    <reference value="Organization/f001"/>
  </organization>

  <!-- there's no source record for a Smart on FHIR consent -->

  <!-- now the consent details itself start -->

  <!-- smart on fhir is always the base opt-in policy -->
  <policyRule value="http://hl7.org/fhir/ConsentPolicy/opt-in"/>

  <!-- each scope that relates to FHIR resource access is represented as an exception -->
  <except>  
    <!-- this except corresponds to MedicationRequest/read -->
    <type value="permit"/>
    <!-- no actors here, or anything, just read/write and the resource type -->
    <action> 
      <coding>
        <system value="http://hl7.org/fhir/consentaction"/>
        <code value="access"/>
      </coding>
    </action>
    <class>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </class>
  </except>
</Consent>
